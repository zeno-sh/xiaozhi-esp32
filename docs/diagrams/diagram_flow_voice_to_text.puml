@startuml 语音识别流程
!theme plain
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 60
skinparam responseMessageBelowArrow true

actor 用户
participant "Application" as App
participant "音频处理器" as Audio
participant "唤醒词检测" as WakeWord
participant "Opus编码器" as Encoder
participant "协议层" as Protocol
participant "云端ASR服务" as ASR
participant "大模型LLM" as LLM

autonumber

用户 -> Audio: 发出声音
Audio -> WakeWord: 音频数据流
WakeWord -> App: 检测到唤醒词
App -> App: 更新状态(kDeviceStateListening)
App -> Audio: 开始录制对话
Audio -> App: 原始音频数据流
App -> Encoder: 编码音频数据
Encoder -> Protocol: 编码后的音频包
Protocol -> ASR: 发送音频数据流
ASR -> ASR: 实时语音识别
ASR --> Protocol: 返回文本结果
Protocol --> App: 识别结果文本
App -> Protocol: 发送文本到LLM
Protocol -> LLM: 文本请求处理
LLM -> LLM: 生成回复
LLM --> Protocol: 文本回复
Protocol --> App: 接收文本回复
App -> App: 更新状态(kDeviceStateSpeaking)

@enduml 