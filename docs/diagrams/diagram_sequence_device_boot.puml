@startuml 设备启动流程
!theme plain
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 60
skinparam responseMessageBelowArrow true

participant "ESP32引导程序" as Boot
participant "Application" as App
participant "WiFi管理器" as WiFi
participant "IoT管理器" as IoT
participant "物理设备" as Devices
participant "网络服务" as Network

autonumber

Boot -> App: 系统启动
App -> App: 初始化状态(kDeviceStateStarting)
App -> WiFi: 初始化WiFi
WiFi -> App: WiFi初始化完成
App -> App: 更新状态(kDeviceStateWifiConfiguring)
WiFi -> Network: 连接网络
Network --> WiFi: 连接成功
WiFi --> App: 网络已连接
App -> App: 更新状态(kDeviceStateIdle)
App -> IoT: 初始化IoT设备
IoT -> Devices: 注册物理设备
Devices --> IoT: 设备注册成功
IoT --> App: IoT初始化完成
App -> Network: 连接到云服务
Network --> App: 连接成功
App -> App: 更新状态(kDeviceStateConnecting)
App -> App: 设备就绪，等待交互

@enduml 