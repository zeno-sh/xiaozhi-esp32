@startuml 语音合成流程
!theme plain
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 60
skinparam responseMessageBelowArrow true

participant "Application" as App
participant "协议层" as Protocol
participant "云端TTS服务" as TTS
participant "Opus解码器" as Decoder
participant "音频输出" as Audio
participant "IoT管理器" as IoT
participant "显示控制" as Display
actor 用户

autonumber

App -> Protocol: 请求TTS(文本内容)
Protocol -> TTS: 发送TTS请求
TTS -> TTS: 生成语音音频
TTS --> Protocol: 流式返回音频数据
Protocol --> App: 音频数据流
App -> Decoder: 解码音频数据
Decoder -> Audio: 播放音频
App -> IoT: 更新扬声器状态
App -> Display: 更新显示内容(对话文本)
Audio -> 用户: 播放语音
App -> App: 监控播放进度
Audio --> App: 播放完成
App -> App: 更新状态(kDeviceStateIdle)
App -> IoT: 更新设备状态
App -> Display: 更新显示(空闲状态)

@enduml 